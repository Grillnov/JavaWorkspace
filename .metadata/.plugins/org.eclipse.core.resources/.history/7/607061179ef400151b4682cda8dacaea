import javax.swing.JFrame;
import javax.swing.JButton;
import javax.swing.ImageIcon;

import java.awt.GridLayout;
import java.awt.Toolkit;
import java.awt.Image;
import java.awt.event.*;

import java.util.ArrayList;
import java.util.Queue;
import java.util.LinkedList;
import java.util.Random;

class ButtonIcons
{
	public ImageIcon Husky;
	public Image Doge;
	public ImageIcon RoadBlock;
	public ImageIcon DefaultBackground;
	
	ButtonIcons()
	{
		Toolkit tk = Toolkit.getDefaultToolkit();
		this.Doge = tk.createImage("./Doge.gif");
		this.Husky = new ImageIcon("./Husky.png");
		this.RoadBlock = new ImageIcon("./RoadBlock.png");
		this.DefaultBackground = new ImageIcon("./Default.png");
	}
}

class GridBlock extends JButton
{
	static public ButtonIcons icons = new ButtonIcons();
	private int coordX;//Coordinate of the grid
	private int coordY;
	private int status;//Is it now a husky, a roadblock, or simple background?
	
	GridBlock(int coordX, int coordY)
	{
		this.coordX = coordX;
		this.coordY = coordY;
		this.status = 0;
	}
	void updateStatus(int newStatus)
	{
		this.status = newStatus;
		switch(this.status)
		{
		case 0:
			this.setIcon(icons.Husky);
			break;
		case 1:
			this.setIcon(icons.RoadBlock);
			break;
		case 2:
			this.setIcon(icons.DefaultBackground);
			break;
		}
	}
	int getCoordX()
	{
		return this.coordX;
	}
	int getCoordY()
	{
		return this.coordY;
	}
	int getStatus()
	{
		return this.status;
	}
}

public class GUIMainbody
{
	class AddRoadBlock implements ActionListener
	{
		@Override
		public void actionPerformed(ActionEvent arg0) 
		{
			GridBlock BlockPressed = (GridBlock)arg0.getSource();
			BlockPressed.updateStatus(1);
			//TODO find the shortest route to escape
			Queue<> container = new LinkedList<int>();
		}
	}
	
	private JFrame Mainbody;
	private GridLayout ChessGrid;
	private ArrayList<GridBlock> Blocks;
	private int GridSize;
	public AddRoadBlock RoadBlocker = new AddRoadBlock();
	
	private int HuskyPositionx;
	private int HuskyPositiony;
	
	public GUIMainbody(String Title)
	{
		this.Mainbody = new JFrame(Title);
		this.GridSize = 21;
		this.Blocks = new ArrayList<GridBlock>();
		
		InitializeGrid();
		InitializeWindow();
		InitializeHuskyPosition();
		InitializeRoadBlockPosition();
	}
	
	private void InitializeWindow()
	{
		Mainbody.setVisible(true);
		Mainbody.setSize(840, 840);
		Mainbody.setLocationRelativeTo(null);
		Mainbody.setIconImage(GridBlock.icons.Doge);
		
		Mainbody.setResizable(false);
		Mainbody.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
	}
	
	private void InitializeGrid()
	{
		ChessGrid = new GridLayout(GridSize, GridSize, 0, 0);
		Mainbody.setLayout(ChessGrid);
		for(int x = 0; x!=GridSize; ++x)
		{
			for(int y = 0; y!=GridSize; ++y)
			{
				Blocks.add(new GridBlock(x, y));
				UpdateGridStatus(x, y, 2);
			}
		}
		for(GridBlock i : Blocks)
		{
			Mainbody.add(i);
			i.addActionListener(RoadBlocker);
		}
	}
	
	public void InitializeHuskyPosition()
	{
		int InitialCoordinate = this.GridSize / 2;
		HuskyPositionx = InitialCoordinate;
		HuskyPositiony = InitialCoordinate;
		this.UpdateGridStatus(HuskyPositionx, HuskyPositiony, 0);
	}
	
	public void InitializeRoadBlockPosition()
	{
		Random randomCoord = new Random();
		for(int i = 0; i!= 40; ++i)
		{
			int x = randomCoord.nextInt(21);
			int y = randomCoord.nextInt(21);
			while(x == this.HuskyPositionx || y == this.HuskyPositiony)
			{
				x = randomCoord.nextInt(21);
				y = randomCoord.nextInt(21);
			}
			this.UpdateGridStatus(x, y, 1);
		}
	}
	
	public void UpdateGridStatus(int x, int y, int status)
	{
		this.Blocks.get(x*this.GridSize + y).updateStatus(status);
	}
	
	public void Reset()
	{
		//TODO : reset
	}
	
	public static void main(String[] Args)
	{
		GUIMainbody mainBody = new GUIMainbody("Chase down the Husky");
	}
}
